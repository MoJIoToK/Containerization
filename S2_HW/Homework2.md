# Контейнеризация (семинары)
## Урок 2. Механизмы контрольных групп

### Задание
1. запустить контейнер с ubuntu, используя механизм LXC
2. ограничить контейнер 256 Мб ОЗУ и проверить, что ограничение работает
3. добавить автозапуск контейнеру, перезагрузить ОС и убедиться, что контейнер действительно запустился самостоятельно
4. при создании указать файл, куда записывать логи
5. после перезагрузки проанализировать логи

### Решение

- Для работы с функционалом lxc контейниризации для начала необходимо установить необходимые пакеты:

```
sudo apt  install lxd-installer
```

- Далее Поскольку создание контейнера с помощью lxc происходит в первый раз, необходимо инициализировать lxc на машине:

```
lxd init
```
После этого в консоли необходимо ответить на пару вопросов, для создания контейнера
![Cсылка на скриншот с инизализацией](https://github.com/MoJIoToK/Containerization/blob/main/S2_HW/pic/Untitled.png)

- Убеждаемся в наличии/отстутствии существующих контейнеров:

```
lxc storage list
lxc network list
lxc remote list
lxc image -c dasut list ubuntu:| head -n 11
```
- Далее создаём контейнер с именем `db1`:
```
sudo lxc-create -t download -n db1 -- -d ubuntu -r jammy -a amd64
```
Необходимо было ввести именно эту команду, т.к. не было образов ОС. А так можно было бы всё это проделать командой:
``` 
sudo lxc-create -n test123 -t ubuntu
```
- Пропишем в настройках автостарт и ограничим память контейнера 256 Мб:
```
cd /var/lib/
sudo nano /var/lib/lxc/db1/config

<<<___>>>
lxc.cgroup2.memory.max = 256M //максимальная память контейнера 256 Мб
lxc.start.auto = 1 //запуск контейнера автоматически
<<<___>>>
```
- Запустим контейнер и войдём в него:
```
sudo lxc-start -n db1
sudo lxc-attach -n db1
```
- Проверить автозапуск контейнера после перезагрузки системы можно командой:
```
lxc-ls -f
```
В консоль выведется столбец `AUTOSTART` и `IPV4` где будет указано 1 в случае работы в режиме автостарта и IP который задавали при инициализации.

Список контейнеров:
![Cсылка на скриншот со списком контейнеров](https://github.com/MoJIoToK/Containerization/blob/main/S2_HW/pic/Autorun.png)

Проверить также можно войдя в него:
```
sudo lxc-attach -n db1
```
- Для просмотра выделенной и свободной памяти используем следующую команду:
```
free -m
```
Память занимаемая контейнером:
![Cсылка на скриншот с памятью контейнера](https://github.com/MoJIoToK/Containerization/blob/main/S2_HW/pic/memory%202.png)

- Для логирования, запустим контейнер следующей командой:
```
sudo lxc-start -n db1 --logfile log.log
```
Запуск с логированием:
![Cсылка на скриншот с запуском лога](https://github.com/MoJIoToK/Containerization/blob/main/S2_HW/pic/Log1.png)

Содержание файла с логами:
![Cсылка на скриншот с запуском лога](https://github.com/MoJIoToK/Containerization/blob/main/S2_HW/pic/Log.png)

Команды используемые для решения:
![Cсылка на скриншот с историей команд](https://github.com/MoJIoToK/Containerization/blob/main/S2_HW/pic/History.png)